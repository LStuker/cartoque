<% title "Bases de données" %>

<div id="databases" class="items_list grid_12">
  
<%= action_links do %>
  <div class="contextual contextswitch">
    <span class="toggle">Changer de vue</span>
    <ul class="contexts">
      <%= context_li "Vue synthétique", databases_path(:view_mode => "normal"), :current => (databases_view_mode == "normal") %>
      <%= context_li "Vue détaillée", databases_path(:view_mode => "detailed"), :current => (databases_view_mode == "detailed") %>
    </ul>
  </div>
  <%= link_to "Déclarer un serveur de bases de données", new_database_path %>
<% end %>

<% postgres_databases = @databases.select{|db| db.database_type == 'postgres'} %>
<% oracle_databases   = @databases.select{|db| db.database_type == 'oracle'} %>

</div>

<div class="database_type grid_6 clearfix">
<h1>Postgres</h1>
<table class="pretty">
  <tr>
    <th>Serveurs</th>
    <%= database_headers_for("postgres") %>
  </tr>
  <% for database in postgres_databases %>
    <% height = database.postgres_report.size %>
    <% height = 1 if height == 0 %>
    <tr>
      <td rowspan="<%= height %>">
        <%= database_nodes database %>
        <%= action_links do %>
          <%= link_to "edit", edit_database_path(database) %>
          | <%= link_to "suppr", database, :confirm => 'Are you sure?', :method => :delete %>
        <% end %>
      </td>
      <% if database.postgres_report.present? %>
        <%= render :partial => 'postgres_report', :collection => database.postgres_report %>
      <% else %>
        <td colspan="4" class="center">Information non disponible.</td>
      <% end %>
    </tr>
  <% end %>
</table>
</div>

<div class="database_type grid_6">
<h1>Oracle</h1>
<table>
  <tr>
    <th>Serveurs</th>
    <%= database_headers_for("oracle") %>
  </tr>
  <% for database in oracle_databases %>
    <% height = database.oracle_report.size %>
    <% height = 1 if height == 0 %>
    <tr>
      <td rowspan="<%= height %>">
        <%= database_nodes database %>
        <%= action_links do %>
          <%= link_to "edit", edit_database_path(database) %>
          | <%= link_to "suppr", database, :confirm => 'Are you sure?', :method => :delete %>
        <% end %>
      </td>
      <% if database.oracle_report.present? %>
        <%= render :partial => 'oracle_report', :collection => database.oracle_report %>
      <% else %>
        <td colspan="4" class="center">Information non disponible.</td>
      <% end %>
    </tr>
  <% end %>
</table>
</div>
