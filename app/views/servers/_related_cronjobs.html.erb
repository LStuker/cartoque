<% exploitation_jobs = @server.cronjobs.where("definition_location like ?", "%/exploit%") %>
<div class="related-ci related-cronjobs">
  <div class="informations<%= " more-child" if exploitation_jobs.count > 0 %>">
    <h3><%= link_to "#{@server.cronjobs.count} crons", cronjobs_path(:by_server => @server) %></h3>
    <div class="details">dont
      <%= link_to_if exploitation_jobs.count > 0, pluralize(exploitation_jobs.count, "cron")+" d'exploitation",
                     cronjobs_path(:by_server => @server, :by_definition => "exploit") %>
    </div>
    <ul class="hidden">
      <% exploitation_jobs.group_by(&:definition_location).sort.each do |location,jobs| %>
        <% short_location = location.gsub("/etc/cron.d/","") %>
        <%= content_tag :li do %>
          <%= link_to short_location + (jobs.count > 1 ? "(x#{jobs.count})" : ""),
                      "##{short_location.parameterize}", :rel => "facebox" %>
        <% end %>
        <%= render :partial => "cronjobs/cron_collection",
                   :locals => { :title => "Crons #{short_location} sur #{@server}", :html_id => short_location.parameterize, :crons => jobs,
                                :context => "Tous les crons de " + link_to(@server.name, cronjobs_path(:by_server => @server.id)) } %>
      <% end %>
    </ul>
  </div>
</div>
